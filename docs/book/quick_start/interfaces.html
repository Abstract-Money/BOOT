<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Interfaces - BOOT documentation</title>


        <!-- Custom HTML head -->
        
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../intro.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li class="chapter-item expanded "><a href="../quick_start/index.html"><strong aria-hidden="true">2.</strong> Quick Start</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../quick_start/interfaces.html" class="active"><strong aria-hidden="true">2.1.</strong> Interfaces</a></li><li class="chapter-item expanded "><a href="../quick_start/env-variable.html"><strong aria-hidden="true">2.2.</strong> Environment Vars</a></li><li class="chapter-item expanded "><a href="../quick_start/scripting.html"><strong aria-hidden="true">2.3.</strong> Scripting</a></li></ol></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">BOOT documentation</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="interfaces"><a class="header" href="#interfaces">Interfaces</a></h1>
<p>To get started with BOOT, create a new folder in your project's package directory and add it to the workspace members.</p>
<pre><code class="language-bast">cd packages
cargo init --lib interfaces
cd interfaces
</code></pre>
<p>Following this example, the project's structure should eventually look like:</p>
<pre><code class="language-path">.
├── Cargo.toml
├── my-contract
│   ├── Cargo.toml
│   └── src
│       ├── contract.rs (execute, instantiate, query, ...)
│       └── ..
├── packages
│   ├── my-project
│   │   └── my-contract.rs (msgs)
│   └── interfaces
│       └── my-contract.rs (interface)
└── scripts
    ├── Cargo.toml
    └── src
        └── bin
            ├── deploy.rs
            └── test_my_contract.rs
</code></pre>
<p>Now add <code>boot-core</code> to <code>Cargo.toml</code> along with the package that contains the contract's endpoint messages.</p>
<pre><code class="language-toml">[dependencies]
boot-core = &quot;0.1.4&quot; # latest version as of writing this article
my-project = { path = &quot;../my-project&quot;}
</code></pre>
<h2 id="defining-contract-interfaces"><a class="header" href="#defining-contract-interfaces">Defining Contract Interfaces</a></h2>
<p>The contract interface is a struct that provides accessible methods to deploy and interact with an instance of your contract. Let's see how to use it.</p>
<p>First, create a new file in the src directory of the interfaces package, and add it to the library declaration</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>touch src/my-contract.rs
echo 'pub mod my-contract;' &gt;&gt; src/lib.rs
<span class="boring">}
</span></code></pre></pre>
<p>In your new file, define a struct for your contract interface and provide the [<code>Instantiate</code>|<code>Execute</code>|<code>Query</code>|<code>Migrate</code>] messages to the <code>boot_contract</code> macro, which will generate fully-typed instantiate, execute, query, and migrate methods for this struct.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>use boot_core::prelude::*;
use my_project::my_contract::{InstantiateMsg, ExecuteMsg, QueryMsg, MigrateMsg};

#[boot_contract(InstantiateMsg, ExecuteMsg, QueryMsg, MigrateMsg)]
pub struct MyContract&lt;Chain&gt;;
<span class="boring">}
</span></code></pre></pre>
<p>The generic <code>&lt;Chain&gt;</code> argument allows you to write functions for your interface that will be executable in different environments.</p>
<blockquote>
<p><em>If your entry point messages have any generic arguments, pull them out into newtypes before passing them into the macro.</em></p>
</blockquote>
<h2 id="constructor"><a class="header" href="#constructor">Constructor</a></h2>
<p>Next, you'll want to define the constructor for the interface we just defined:</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;Chain: BootEnvironment&gt; MyContract&lt;Chain&gt; {
    /// Construct a new instance of MyContract
    /// * `contract_id` - what your contract should be called in local state (*not* on-chain)
    /// * `chain` - the environment to deploy to
    pub fn new(contract_id: &amp;str, chain: &amp;Chain) -&gt; Self {
        // Use an absolute path
        let wasm_path = &quot;../../target/wasm32-unknown-unknown/release/my-contract.wasm&quot;;
       // OR give the contract name and set ARTIFACTS_DIR environment variable to the artifacts folder. 
       let wasm_path = &quot;my-contract&quot;;
        Self(
            Contract::new(contract_id, chain)
            .with_mock(Box::new(
                  ContractWrapper::new_with_empty(
                    my_contract::contract::execute,
                    my_contract::contract::instantiate,
                    my_contract::contract::query,
                )))
                .with_wasm_path(wasm_path),
        )
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>Notice that we build the <code>Contract</code> instance and point it to the contract code using <code>with_wasm_path()</code>, where we provide the contract name <code>&quot;my-contract&quot;</code>. This contract name will be used to search the artifacts directory (set by <code>ARTIFACTS_DIR</code> env variable) for a <code>my-contract.wasm</code> file. Alternatively you can specify a path to the wasm artifact after running <code>RUSTFLAGS='-C link-arg=-s' cargo wasm</code> in the contract's directory. See the CosmWasm documentation on compiling your contract for more information.</p>
<h2 id="functions"><a class="header" href="#functions">Functions</a></h2>
<p>Now we can start writing executable functions for our contracts with ensured type safety.
We can define functions that are generic or that can only be used called in a specific environment.
The environments that are currently supported are:</p>
<ol>
<li><a href="https://crates.io/crates/cw-multi-test">cw-multi-test</a></li>
<li>Blockchain daemons <a href="https://github.com/CosmosContracts/juno">junod</a>, <a href="https://github.com/osmosis-labs/osmosis">osmosisd</a>,...</li>
</ol>
<h3 id="generic-function"><a class="header" href="#generic-function">Generic function</a></h3>
<p>Generic functions can be executed over any environment.</p>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;Chain: BootEnvironment&gt; MyContract&lt;Chain&gt; {
    pub fn deploy(&amp;self, instantiate_msg: &amp;InstantiateMsg) -&gt; Self {
        let sender = &amp;self.chain.sender();
        self.upload()?;
        let resp = self.instantiate(&amp;instantiate_msg, Some(sender), None)?;
        let my_contract_address = resp.instantiated_contract_address()?;
        log::info!(&quot;deployed my-contract to {}&quot;, my_contract_address);
    }
}
<span class="boring">}
</span></code></pre></pre>
<h3 id="daemon-only-functions"><a class="header" href="#daemon-only-functions">Daemon-only functions</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl MyContract&lt;Daemon&gt; {
    pub fn send_ibc_transaction(&amp;self, msg: &amp;ExecuteMsg) -&gt; Self {
        let resp = self.execute(&amp;msg,None)?;
        let destination_port = resp.event_attr_value(&quot;ibc_transfer&quot;, &quot;destination_port&quot;);?;
    }
}
<span class="boring">}
</span></code></pre></pre>
<h3 id="mock-only-functions"><a class="header" href="#mock-only-functions">Mock-only functions</a></h3>
<pre><pre class="playground"><code class="language-rust"><span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl MyContract&lt;Mock&gt; {
    pub fn call_other_chain (&amp;self, msg: &amp;ExecuteMsg) -&gt; Self {
        let resp = self.execute(&amp;msg,None)?;
        let destination_port = resp.event_attr_value(&quot;ibc_transfer&quot;, &quot;destination_port&quot;);?;
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>Main Function
Now that we have our dependencies setup, we can start writing our script. Either create a new file in the src directory of the scripts/src package, or use the main.rs file that was created by default.
This function is mostly just boilerplate, so you can copy and paste it into your new script file. It will just call your function and give you nicer error traces:
fn main() {
dotenv().ok();
env_logger::init();
use dotenv::dotenv;
if let Err(ref err) = deploy_contract() {
log::error!(&quot;{}&quot;, err);
err.chain()
.skip(1)
.for_each(|cause| log::error!(&quot;because: {}&quot;, cause));
::std::process::exit(1);
}
}
Deployment Function
First, we'll define a function that will deploy our contract to the chain. This function will setup the environment (connecting to the chain), deploy the contract, and return a Result with the contract address.
// scripts/src/my_contract.rs
use anyhow::Result;
use boot_core::networks;
use boot_core::prelude::{instantiate_daemon_env, NetworkInfo};
// Traits for contract deployment
use boot_core::interface::<em>;
use interfaces::my_contract::MyContract;
// Select the chain to deploy to
const NETWORK: NetworkInfo = networks::juno::UNI_5;
const CONTRACT_NAME: &amp;str = &quot;my-contract&quot;;
pub fn deploy_contract() -&gt; anyhow::Result<String> {
// Setup the environment
let (_, <em>sender, chain) = instantiate_daemon_env(network)?;
// Create a new instance of your contract interface
let contract = MyContract::new(CONTRACT_NAME, &amp;chain);
// Upload your contract
contract.upload()?;
// Instantiate your contract
let init_msg = InstantiateMsg {
// ...
};
// The second argument is the admin, the third is any coins to send with the init message
contract.instantiate(init_msg, None, None)?;
// Load and return the contract address
let contract_addr = contract.address()?;
Ok(contract_addr)
}
Additional Scripts
So you have your contract deployed, but what now? You can write additional scripts to interact with your contract. For example, you can write a script to query the contract state, or to execute a contract method.
Here's an example of a script that queries the contract state:
// scripts/src/my_contract.rs
// use ...
use my_contract::{QueryMsg};
// ...
pub fn query_contract() -&gt; Result&lt;()&gt; {
// Setup the environment
let (</em>, <em>sender, chain) = instantiate_daemon_env(NETWORK)?;
// Create a new instance of your contract interface
let contract = MyContract::new(CONTRACT_NAME, &amp;chain);
// Load the contract address (this will use the address set from the previous deploy script)
let contract_addr = contract.address();
// Query the contract
let res = contract.query(QueryMsg::Balance {
address: contract_addr,
})?;
// Print the result
println!(&quot;{:?}&quot;, res);
Ok(())
}
And one that executes a contract method:
// scripts/src/my_contract.rs
// use ...
use my_contract::{ExecuteMsg};
// ...
pub fn execute_contract() -&gt; Result&lt;()&gt; {
// Setup the environment
let (</em>, _sender, chain) = instantiate_daemon_env(NETWORK)?;
// Create a new instance of your contract interface
let contract = MyContract::new(CONTRACT_NAME, &amp;chain);
// Load the contract address (this will use the address set from the previous deploy script)
let contract_addr = contract.address();
// Execute a contract method
let res = contract.execute(ExecuteMsg::UpdateBalance {
address: contract_addr,
balance: Uint128::from(1000000u128),
})?;
// Print the result
println!(&quot;{:?}&quot;, res);
Ok(())
}
Refinement
You can also refine your contract interface to make it easier to use. For example, you can create a function that will execute a specific contract method and return the result, instead of having to call contract.execute and contract.query separately.
// interfaces/src/my_contract.rs
// Import the boot traits
use boot_core::interface::</em>;
// ...
impl&lt;Chain: BootEnvironment&gt; MyContract<Chain> {
pub fn new(contract_id: &amp;str, chain: &amp;Chain) -&gt; Self {
// ...
}
/// Query the balance of an address
/// <code>address</code> - the address to query
pub fn balance(&amp;self, address: Addr) -&gt; Result<BalanceResponse> {
let balance_query = QueryMsg::Balance { address };
self.query(balance_query)
}
/// Update the balance of an address
/// <code>address</code> - the address to update
/// <code>balance</code> - the new balance
pub fn update_balance(&amp;self, address: Addr, balance: Uint128) -&gt; Result<ExecuteResult> {
let update_balance_msg = ExecuteMsg::UpdateBalance {
address,
balance,
};
self.execute(update_balance_msg)
}
}
References
Boot Core
Boot Cw-plus
Abstract Contract Interfaces</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../quick_start/index.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next" href="../quick_start/env-variable.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../quick_start/index.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next" href="../quick_start/env-variable.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>

        <!-- Livereload script (if served using the cli tool) -->
        <script type="text/javascript">
            const wsProtocol = location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsAddress = wsProtocol + "//" + location.host + "/" + "__livereload";
            const socket = new WebSocket(wsAddress);
            socket.onmessage = function (event) {
                if (event.data === "reload") {
                    socket.close();
                    location.reload();
                }
            };

            window.onbeforeunload = function() {
                socket.close();
            }
        </script>



        <script type="text/javascript">
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../searcher.js" type="text/javascript" charset="utf-8"></script>

        <script src="../clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="../highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="../book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->


    </body>
</html>
