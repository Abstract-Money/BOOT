<a href="https://docs.rs/cw-orch/latest" ><img alt="docs.rs" src="https://img.shields.io/docsrs/cw-orch"></a> <a href="https://crates.io/crates/cw-orch" ><img alt="Crates.io" src="https://img.shields.io/crates/d/cw-orch"></a> <a href="https://app.codecov.io/gh/AbstractSDK/cw-orchestrator" ><img alt="Codecov" src="https://img.shields.io/codecov/c/github/AbstractSDK/cw-orchestrator?token=CZZH6DJMRY"></a>

# cw-orchestrator

Your go-to multi-environment [CosmWasm](https://cosmwasm.com/) smart-contract scripting library. The documentation within this crate will show you how to quickly get started. We provide tutorial-like documentation at [orchestrator.abstract.money](https://orchestrator.abstract.money).

> cw-orchestrator is inspired by [terra-rust-api](https://github.com/PFC-Validator/terra-rust) and uses [cosmos-rust](https://github.com/cosmos/cosmos-rust) for [protocol buffer](https://developers.google.com/protocol-buffers/docs/overview) gRPC communication.

cw-orchestrator makes it easier to quickly deploy and iterate on CosmWasm contracts. It provides support for multiple CosmWasm execution environment and makes interacting and integrating with smart-contracts much easier.

## How it works

Interacting with a [CosmWasm](https://cosmwasm.com/) contract is done by calling the contract's endpoints using the appropriate message for that endpoint (`ExecuteMsg`,`InstantiateMsg`, `QueryMsg`, `MigrateMsg`, etc.). cw-orchestrator generates type-checked interfaces for your contracts, allowing them to be type-checked at compile time.

### Creating an Interface

In order to generate a type-checked interface to your contract you can either pass the contract's message types into the `contract` macro or you can add the `interface` macro to your endpoint function exports!

#### `contract` macro

Provide your messages to a new struct that's named after your contract. In this case a CW20 message.

```rust,ignore
use cw_orch::contract;
// Provide the messages in the order Init, Exec, Query, Migrate.
#[contract(InstantiateMsg, ExecuteMsg, QueryMsg, MigrateMsg)]
pub struct Cw20;
```

#### `interface` macro

You create a contract interface by adding the `interface` macro to your contract endpoints. The name of the interface will be the crate name is PascalCase.  

```rust,ignore
#[cw_orch::interface]
fn instantiate(...)

#[cw_orch::interface]
fn execute(...)
```

#### Usage

These macros implement a set of traits for the struct. These traits contain functions that can then be used to interact with the contract.

You can then use this interface to interact with the contract:

```rust,ignore
let cw20_base: Cw20<Chain> = Cw20::new("my_token", chain);
// instantiate a CW20 token instance
let cw20_init_msg = cw20_base::msg::InstantiateMsg {
    decimals: 6,
    name: "Test Token".to_string(),
    initial_balances: vec![Cw20Coin {
        address: sender.to_string(),
        amount: 1000000u128.into(),
    }],
    marketing: None,
    mint: None,
    symbol: "TEST".to_string(),
};
cw20_base.instantiate(&cw20_init_msg, None, None)?;
// Query balance
// Notice that this query is generated by a macro and not defined in the object itself!
// There is also no need to provide a return type of the query.
let balance = cw20_base.balance(sender.to_string())?;
```

<!-- TODO: Examples You can find [the full cw20 implementation here](cw-orch/examples/cw20.rs). An example of how to interact with a contract in `cw-multi-test` can be found [here](cw-plus-orc/examples/cw-plus-mock.rs) while the same interaction on a real node can be found [here](cw-plus-orc/examples/cw-plus-daemon.rs). -->

## Features

cw-orchestrator provides two additional macros that can be used to improve the scripting experience.

### ExecuteFns

The `ExecuteFns` macro can be added to the `ExecuteMsg` definition of your contract. It will generate a trait that allows you to call the variants of the message directly without the need to construct the struct yourself.

The macros should only be added to the structs when the "interface" trait is enable. This is ensured by the `interface` feature in the following example

Example:

```rust,ignore
#[cfg_attr(feature="interface", derive(cw_orch::ExecuteFns))]
pub enum ExecuteMsg{
    /// Freeze will make a mutable contract immutable, must be called by an admin
    Freeze {},
    /// UpdateAdmins will change the admin set of the contract, must be called by an existing admin,
    /// and only works if the contract is mutable
    UpdateAdmins { admins: Vec<String> },
    /// the `payable` attribute will add a `coins` argument to the generated function
    #[cfg_attr(feature="interface", derive(cw_orch::payable))]
    Deposit {}
}

#[contract(Empty,ExecuteMsg,Empty,Empty)]
struct Cw1

impl<Chain: CwEnv> Cw1<Chain> {
    pub fn test_macro(&self) {
        self.freeze().unwrap();
        self.update_admins(vec![]).unwrap();
        self.deposit(&[Coin::new(13,"juno")]).unwrap();
    }
}
```

> We recommend shielding the `ExecuteMsgFns` macro behind a feature flag to avoid pulling in `cw-orchestrator` by default.
> The resulting derive would look like this: `#[cfg_attr(feature = "interface", derive(cw_orch::ExecuteFns))]`

For nested execute messages you can add an `impl_into` attribute. This expects the message to implement the `Into` trait for the provided type.

### QueryFns

The `QueryFns` derive macro works in the same way as the `ExecuteFns` macro but it also uses the `#[returns(QueryResponse)]` attribute from `cosmwasm-schema` to generate the queries with the correct response types.

# Contributing

We'd really appreciate your help! Please read our [contributing guidelines](docs/src/contributing.md) to get started.

## Documentation

The documentation is generated using [mdbook](https://rust-lang.github.io/mdBook/index.html). Edit the files in the `docs/src` folder and run

```shell
cd docs && mdbook serve --open --port 5000
```

to view the changes.

# Testing
To test the full application you can run the following command:

```shell
cargo test --jobs 1 --all-features
```

# References

Enjoy scripting your smart contracts with ease? Build your contracts with ease by using [Abstract](https://abstract.money).

# Disclaimer

This software is provided as-is without any guarantees.
